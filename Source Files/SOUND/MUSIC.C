#include "music.h"
#include <stdio.h>

UINT32 prev_time;
int note_playing;
int totalNotes;

const int musicSongRight[] = 
{
	0x0AA, 0x0E2, 0x0D6, 0x0BE, 0x0D6, 0x0E2,
	0x0FE, 0x0FE, 0x0D6, 0x0AA, 0x0BE, 0x0D6,
	0x0E2, 0x0D6, 0x0BE, 0x0AA,	
	0x0D6, 0x0FE, 0x0FE, 0x000,
	
	0x000, 0x0BE, 0x0A0, 0x07F, 0x08F, 0x0A0,
	0x0AA, 0x0D6, 0x0AA, 0x0BE, 0x0D6,
	0x0E2, 0x0E2, 0x0D6, 0x0BE, 0x0AA,
	0x0D6, 0x0FE, 0x0FE, 0x000
	
	
};

const int musicSongLeft[] = 
{
	0x2A7, 0x000, 0x2A7, 0x000, 0x2A7, 0x000, 0x2A7, 0x000,
	0x3F9, 0x000, 0x3F9, 0x000, 0x3F9, 0x000, 0x3F9, 0x000,
	0x2A7, 0x000, 0x2A7, 0x000, 0x2A7, 0x000, 0x2A7, 0x000,
	0x3F9, 0x000, 0x3F9, 0x000, 0x3F9, 0x000, 0x3bA, 0x357,
	
	0x17D, 0x000, 0x17D, 0x000, 0x17D, 0x000, 0x17D, 0x000,
	0x1AC, 0x000, 0x1AC, 0x000, 0x1AC, 0x000, 0x1AC, 0x000,
	0x153, 0x000, 0x153, 0x000, 0x153, 0x000, 0x153, 0x000,
	0x3F9, 0x000, 0x3F9, 0x000, 0x3F9, 0x000, 0x000, 0x000,
	
	
	
	
};

const int durationRight[] = 
{
	8,4,4,8,4,4,
	8,4,4,8,4,4,
	12,4,8,8,
	8,8,8,8,
	
	4,8,4,8,4,4,
	12,4,8,4,4,
	8,4,4,8,8,
	8,8,8,8
};

const int durationLeft[] = 
{
	8,8,8,8,
	8,8,8,8,
	8,8,8,8,
	8,8,8,4,4,
	
	8,8,8,8,
	8,8,8,8,
	8,8,8,8,
	8,8,8,8
};

void start_music(UINT32 time_now)
{
	totalNotes = 40;
	note_playing = 0;
	prev_time = time_now;
	write_psg(0x00, musicSongRight[note_playing]); /* set channel A fine tune = 248 */
	write_psg(0x01, 0x00); 	/* set channel A coarse tune = 0 */
	write_psg(0x07, 0x3E); 	/* enable channel A on mixer */
	write_psg(0x08, 0x0F);	/* set channel A volume = 11 */
}

void update_music(UINT32 time_now)
{
	printf("T%d - P%d\n",time_now, prev_time);
	if (time_now - prev_time >= durationRight[note_playing])
	{
		note_playing++;
		note_playing = note_playing % totalNotes;
		write_psg(0x00, musicSongRight[note_playing]);
		prev_time = time_now;
	}
	
	if (time_now - prev_time >= durationRight[note_playing])
	{
		note_playing++;
		note_playing = note_playing % totalNotes;
		write_psg(0x00, musicSongRight[note_playing]);
		prev_time = time_now;
	}
}